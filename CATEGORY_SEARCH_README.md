# Amazon Category Search Tool

## 概要

Amazonビジネス割引ページで、カテゴリーキーワードを使って商品を検索し、全商品を表示するツールです。

## 機能

1. **自動ログイン**: Amazonに自動的にログインします（OTP自動取得機能付き）
2. **カテゴリー検索**: 3つのキーワードで順番に検索します
   - IT関連機器
   - 医療用品・消耗品
   - 日用品・食品・飲料
3. **全商品表示**: 各検索結果をスクロールしながら全商品を表示
4. **ページネーション対応**: 複数ページがある場合は自動的に次のページへ移動

## 実行方法

### 1. 初回セットアップ（amazon_auto.pyと同じ）

必要なファイルが既に準備されている場合はスキップできます。

#### .envファイルの作成
```
AMAZON_EMAIL=your_email@gmail.com
AMAZON_PASSWORD=your_password
```

#### Gmail API認証情報の配置
- `data`フォルダに OAuth 2.0 認証情報ファイルを配置
- ファイル名: `client_secret_446842116198-...json`

### 2. 実行

#### Windowsの場合
```bash
run_category_search.bat
```

#### コマンドラインから直接実行
```bash
python category_search.py
```

## 実行フロー

1. **ログイン処理**
   - 保存されたセッションがある場合は再利用
   - セッションがない/期限切れの場合は新規ログイン
   - OTP（ワンタイムパスワード）が必要な場合は自動取得

2. **ビジネス割引ページへ移動**
   - Amazonビジネス割引ページに自動遷移

3. **カテゴリー検索（3回実施）**
   - キーワード1: 「IT関連機器」を検索
     - 検索結果をスクロール表示
     - ページネーションがあれば次のページへ
   - キーワード2: 「医療用品・消耗品」を検索
     - 同様にスクロール・ページネーション
   - キーワード3: 「日用品・食品・飲料」を検索
     - 同様にスクロール・ページネーション

4. **完了**
   - 全キーワードの検索が完了したらブラウザを閉じる

## 技術仕様

### 使用しているXPath

- **検索入力欄**: `/html/body/div[1]/header/div/div[1]/div[2]/div[1]/form/div[2]/div[1]/input`
- **検索ボタン**: `/html/body/div[1]/header/div/div[1]/div[2]/div[1]/form/div[3]/div/span/input`

### スクロール設定

- 1ページあたり10回スクロール
- 各スクロール間隔: 1.5秒
- スクロール距離: 500ピクセル

### ページネーション

- 次のページボタンを自動検出
- 最大20ページまで自動遷移
- 次のページがない場合は次のキーワードへ

## トラブルシューティング

### ログインに失敗する場合

1. `.env`ファイルの認証情報を確認
2. Gmail API認証が必要な場合はブラウザで認証
3. パスキーモーダルが表示された場合は手動で閉じる

### 検索結果が表示されない場合

1. ビジネス割引ページに正しくアクセスできているか確認
2. 検索入力欄のXPathが変更されていないか確認
3. ネットワーク接続を確認

### ページネーションが動作しない場合

- Amazonのページ構造が変更された可能性があります
- 手動で確認し、必要に応じてセレクタを更新してください

## amazon_auto.pyとの違い

| 機能 | amazon_auto.py | category_search.py |
|------|----------------|-------------------|
| ログイン | ○ | ○ |
| フィルター適用 | ○ | × |
| カテゴリー検索 | × | ○ |
| 商品データ取得 | ○ | × |
| Google Sheets出力 | ○ | × |
| 商品表示 | ○ | ○ |
| ページネーション | × | ○ |

## カスタマイズ

### 検索キーワードの変更

`category_search.py`の以下の部分を編集：

```python
SEARCH_KEYWORDS = [
    "IT関連機器",
    "医療用品・消耗品",
    "日用品・食品・飲料"
]
```

### スクロール回数の変更

`scroll_product_page_slowly()`関数の`scroll_times`パラメータを調整：

```python
scroll_product_page_slowly(page, scroll_times=10, scroll_delay=1.5)
```

### 最大ページ数の変更

`search_and_display_products()`関数の`page_number`制限を調整：

```python
if page_number > 20:  # この数値を変更
    print(f"\n[WARNING] Reached maximum page limit")
    break
```

## 注意事項

1. **実行時間**: 検索キーワード数とページ数により実行時間が変わります
2. **ブラウザ操作**: 実行中はブラウザを手動で操作しないでください
3. **セッション**: ログインセッションは`amazon_session.json`に保存されます
4. **利用規約**: Amazonの利用規約を遵守してください

## ライセンス

このツールは個人利用を目的としています。商用利用の場合は適切なライセンスを確認してください。
